<html>
    <head>
        <title></title>
    </head>
    <body>
        <h1>Park Map</h1>
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
        <style>
            #map_objects {display: none}
            #map img { max-width: none;}
            #typeToggles label {text-align: center; text-overflow: clip;}
            /* commented colors in hover states are alternative potential bg colors */
            #toggle_Golf-Course:hover{background-color: #F2CA90;/*#F5E1C*/}
            /*{background-color: #DED4F9}*/
            #toggle_Golf-Course.active{background-color: #ED9C28; border-color: #D58512; color:#FFF;}
           /* {background-color: #9269FF; border-color: #7A59D4; color:#FFF;}*/
            #toggle_Aquatic-Center:hover{background-color: #CBD6F4;/*#9EB5F*/}
            #toggle_Aquatic-Center.active{background-color:#4473EA; border-color:#2c5bd3; color:#FFF;}
            #toggle_Park:hover{background-color: #AAD8AB; /*#D1E8D*/}
            #toggle_Park.active{background-color: #5CB85C; border-color: #4CAE4C; color:#FFF;}
            #toggle_Country-Club:hover{background-color: #A9DCEB;/*#D0EAF*/}
            #toggle_Country-Club.active{background-color:#5BC0DE; border-color: #46B8DA; color:#FFF; }
            /*#toggle_Tot-Lot:hover{background-color: #F2CA90;}*/
            /*#toggle_Tot-Lot.active{background-color: #ED9C28; border-color: #D58512; color:#FFF;}*/
            #toggle_Recreation-Center:hover{background-color: #E8A5A3; /*#F0CECD*/}
            #toggle_Recreation-Center.active{background-color:#D9534F; border-color:#D43F3A; color:#FFF;}
            @media (max-width: 600px) {
            	#typeToggles label{	padding: 4px 6px}
            }
        </style>
        <div id="map" class="col-md-12 panel panel-default" style="min-height: 400px;">
        </div>
        <div class="panel panel-default">
        <div class="clearfix" style="padding-top: 20px;">
        <!--<form role="form"> -->
        <div class="form-group" style="text-align:center;">
        	<div id="typeToggles" class="btn-group" data-toggle="buttons" style="text-align:center;">
        <!--
	            <label id="toggle_all" class="btn btn-default"><input type="checkbox" />Show All</label>
	        -->
	        <label id="toggle_Park" class="btn btn-default">
	        	<input type="checkbox" /> Parks <br class="hidden-lg" /> &nbsp;
	        </label>

	        <label id="toggle_Pool" class="btn btn-default">
	        	<input type="checkbox" /> Pools <br class="hidden-lg" /> &nbsp;
	        </label>

	        <label id="toggle_Recreation-Center" class="btn btn-default">
	        	<input type="checkbox" /> Recreation <br class="hidden-lg" />Center
	        </label>        
	        
	        <label id="toggle_Golf-Course" class="btn btn-default">
	        	<input type="checkbox" /> Golf <br class="hidden-lg" />Courses
	        </label>

	        <label id="toggle_Country-Club" class="btn btn-default">
	        	<input type="checkbox" /> Country <br class="hidden-lg" />Club
	        </label>
	        <!--
	        <label id="toggle_Tot-Lot" class="btn btn-default col-xs-2">
	        <input type="checkbox" /> Tot <br class="hidden-lg" />
	        Lots
	        </label>
	    -->

        	</div>
        </div>
        <div id="featureToggles" class="form-group col-xs-12">
	        <h4 style="text-align:center;"><p><span class="glyphicon glyphicon-arrow-up"></span> Filter by type and/or filter by amenity <span class="glyphicon glyphicon-arrow-down"></span></p></h4>
	        <div class="col-xs-4">
		        <label class="checkbox-inline col-xs-12" style="margin-left: 10px;"><input type="checkbox" value="Aquatic Facilities" /> Aquatic Facilities</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Ball Field" /> Ball Field</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Basketball Court" /> Basketball Court</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Carriage House" /> Carriage House</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Chamber Park Church" /> Chamber Park Church</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Childerley Chapel" /> Childerley Chapel</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Drinking Fountain" /> Drinking Fountain</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Fitness Center" /> Fitness Center</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Gazebo" /> Gazebo</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Gymnasium" /> Gymnasium</label>
		    </div>
		    <div class="col-xs-4">
		        <label class="checkbox-inline col-xs-12" style="margin-left: 10px;"><input type="checkbox" value="Jogging Path" /> Jogging Path</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Meeting Room" /> Meeting Room</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Multi-purpose Rooms" /> Multi-purpose Rooms</label>        
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Museum" /> Museum</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Natural Wetlands" /> Natural Wetlands</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Nature Trail" /> Nature Trail</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Outdoor Ice Skating" /> Outdoor Ice Skating</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Outdoor Pool" /> Outdoor Pool</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Parking" /> Parking</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Picnic Table" /> Picnic Table</label>
		    </div>
		    <div class="col-xs-4">
		        <label class="checkbox-inline col-xs-12" style="margin-left: 10px;"><input type="checkbox" value="Play Structure" /> Play Structure</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Preschool" /> Preschool</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Recreation Center" /> Recreation Center</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Sand Volleyball Courts" /> Sand Volleyball Courts</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Shelter" /> Shelter</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Soccer Field" /> Soccer Field</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Tennis Court" /> Tennis Court</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Walking Path" /> Walking Path</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Walking Track" /> Walking Track</label>
		        <label class="checkbox-inline col-xs-12"><input type="checkbox" value="Washrooms" /> Washrooms</label>
	    	</div>
        </div>
        <!--- </form> -->
        </div>
        </div>
        <div id="map_objects">
        {module_webapps,15712,a,,,,true,100,,1}
        </div>
        <script>
$( document ).ready(function() {

//==============================================================================
var activeItem;

function initialize() {
//-----------start variable scope for each object----------------------	
	var mapOptions = {
		zoom: 13,
		center: new google.maps.LatLng(42.139541,-87.928747)
	};
	
	var map = new google.maps.Map(document.getElementById('map'), mapOptions);

	var infoWindow = new google.maps.InfoWindow({ 
			maxWidth: Math.round( $('#map').width()*.65 )
		});
	
	$('#map_objects > div[data-visible="true"]').each(function(){
	//-----------start building map objects-----------
		var id = $(this).attr('id');
		var type = $(this).data('type');
		var parkDetails = this.outerHTML;
		//var infoWidth = ;
		var pin_latlng;
		var pinImage;

	//creating pin location from GPS coordinates either manually inputed or derived from the provided address
		if ( $(this).data('custom_lat') && $(this).data('custom_lng')  ){
			pin_latlng = new google.maps.LatLng( $(this).data('custom_lat') , $(this).data('custom_lng') )
		}
		else{
			pin_latlng = new google.maps.LatLng( $(this).data('BC_lat') , $(this).data('BC_lng') )
		};

	//setting pin color based on 'type'
		if (type == 'Pool'){pinImage = 'http://maps.google.com/mapfiles/ms/micons/blue.png'}
		else if (type == 'Country Club'){pinImage = 'http://maps.google.com/mapfiles/ms/micons/lightblue.png'}
		else if (type == 'Golf Course'){pinImage = 'http://maps.google.com/mapfiles/ms/micons/orange.png'}
		else if (type == 'Park'){pinImage = 'http://maps.google.com/mapfiles/ms/micons/green.png'}
		else if (type == 'Recreation Center'){pinImage = 'http://maps.google.com/mapfiles/ms/micons/red.png'}
		else {pinImage = 'http://maps.google.com/mapfiles/ms/micons/red.png'};


		var marker = new google.maps.Marker({	
			map: map,
			position: pin_latlng,
			title: $(this).data('name'),
			icon: pinImage
		});
//result 
	
		google.maps.event.addListener( marker, 'click', function() {
			infoWindow.close()
			infoWindow.setContent( parkDetails )
			infoWindow.open( map, marker);			
		});	

		if( $(this).data('active') == 'true' ) {
			activeItem = marker;
			//infoWindow.open(map, marker)
		}
	//-----------end building map objects-----------

	});
	
};

//==============================================================================

function filterMapObjects() {
	var typeSpecified = $('#typeToggles label input:checked').length>=1;
	var featureSpecified = $('#featureToggles label input:checked').length>=1;
	
	function setVisibleType(){
		$('#typeToggles label input:checked').each( function(){
			var type =  $(this).parent().attr('id').slice( $(this).parent().attr('id').indexOf('_')+1 ).replace(/-/,' ');
			$('#map_objects').children('div[data-type="'+type+'"]').attr('data-visible','true')
		}) 
	};
	
	function setVisibleFeature(){
		$('#featureToggles label input:checked').each( function() {
			$('#map_objects').children('div[data-features*="'+$(this).val()+'"]').attr('data-visible', 'true') ;
		});		
	};

	if ( typeSpecified || featureSpecified)  
		{ $('#map_objects').children('div').attr('data-visible', 'false'); }
	else 
		{ $('#map_objects').children('div').attr('data-visible', 'true'); };

	if (featureSpecified && !typeSpecified) 
		{ setVisibleFeature() };

	if (!featureSpecified && typeSpecified) 
		{ setVisibleType() };

	if (featureSpecified && typeSpecified) {
		
		setVisibleType()

		var array = $('#map_objects').children('div[data-visible="true"]');
		
		array.each( function() 
			{ $(this).attr('data-visible', 'false');	
		});

		$('#featureToggles label input:checked').each( function() {
			array.filter( $('div[data-features*="'+$(this).val()+'"]') ).attr('data-visible', 'true')
		});		
	};

}


//==============================================================================




//==============================================================================

$('#typeToggles label input').change( function(){
	filterMapObjects()
//	$('#map_objects').children('div').attr('data-visible', 'true')
	$('body').trigger('mapRefresh'); 
});

//==============================================================================

$('#featureToggles label input').change( function() {
	filterMapObjects()
	$('body').trigger('mapRefresh'); 
});

//==============================================================================


$('body').on('mapRefresh', function(event) {
	initialize();
		
	if(activeItem){
		google.maps.event.trigger(activeItem, 'click' );
	}

//-----------end initialize function----------------------

});



initialize();



});	


</script>
    </body>
</html>